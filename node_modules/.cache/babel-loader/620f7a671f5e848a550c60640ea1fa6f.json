{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/jackevans/Documents/GitHub/ULA-MScCompSci/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _regeneratorRuntime from \"/Users/jackevans/Documents/GitHub/ULA-MScCompSci/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jackevans/Documents/GitHub/ULA-MScCompSci/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/jackevans/Documents/GitHub/ULA-MScCompSci/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/Users/jackevans/Documents/GitHub/ULA-MScCompSci/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject,\n    _this = this,\n    _jsxFileName = \"/Users/jackevans/Documents/GitHub/ULA-MScCompSci/src/components/PairsAnalyser.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport Plot from 'react-plotly.js';\nimport { ApolloClient } from 'apollo-client';\nimport { HttpLink } from 'apollo-link-http';\nimport { InMemoryCache } from 'apollo-cache-inmemory';\nimport gql from 'graphql-tag';\nimport { useQuery } from '@apollo/react-hooks';\nimport { Stack, VStack, Button, ButtonGroup, Box, Heading, useToast, Center, Spinner, Divider, Popover, PopoverTrigger, PopoverContent, PopoverHeader, PopoverBody, PopoverArrow, PopoverCloseButton, Portal, Link, HStack, Spacer } from \"@chakra-ui/react\";\nimport { std } from 'mathjs';\nimport axios from 'axios';\nexport var client = new ApolloClient({\n  link: new HttpLink({\n    uri: 'https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2'\n  }),\n  fetchOptions: {\n    mode: 'no-cors'\n  },\n  cache: new InMemoryCache()\n});\n\nfunction getDayOfYear() {\n  //https://stackoverflow.com/questions/8619879/javascript-calculate-the-day-of-the-year-1-366\n  var now = new Date();\n  var start = new Date(now.getFullYear(), 0, 0);\n  var diff = now - start + (start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000;\n  var oneDay = 1000 * 60 * 60 * 24;\n  var day = Math.floor(diff / oneDay);\n  return day;\n}\n\nfunction mean(arr, n) {\n  var sum = 0;\n\n  for (var i = 0; i < n; i++) {\n    sum = sum + arr[i];\n  }\n\n  return sum / n;\n}\n\nfunction covariance(arr1, arr2, n) {\n  var sum = 0;\n\n  for (var i = 0; i < n; i++) {\n    sum = sum + (arr1[i] - mean(arr1, n)) * (arr2[i] - mean(arr2, n));\n  }\n\n  return sum / (n - 1);\n}\n\nvar tokenDay_QUERY = gql(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\nquery \\n  tokens($tokenAddress: Bytes!){\\n pairDayDatas( first: 400, \\n orderBy: date, orderDirection: desc,\\n   where: {\\n     pairAddress: $tokenAddress,\\n   }\\n ) {\\n  token0{\\n    name\\n  }\\n  token1{\\n    name\\n  }\\n     date\\n     dailyVolumeToken0\\n     dailyVolumeToken1\\n     dailyVolumeUSD\\n     reserveUSD\\n     dailyTxns\\n }\\n}\"])));\n\nvar PairsAnalyser = function PairsAnalyser(props) {\n  _s();\n\n  var tokPairsID = props.tokPairsID;\n  var time1 = props.time;\n  var ID1 = props.tokID1;\n  var ID2 = props.tokID2;\n  var total1 = 0;\n  var total2 = 0;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      totalData1 = _useState2[0],\n      setData1 = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      totalData2 = _useState4[0],\n      setData2 = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      corPP = _useState8[0],\n      setCorPP = _useState8[1];\n\n  var dataTok1 = {\n    date: [],\n    prices: []\n  };\n  var dataTok2 = {\n    date: [],\n    prices: []\n  };\n  var toast = useToast();\n\n  var _useState9 = useState(7),\n      _useState10 = _slicedToArray(_useState9, 2),\n      time = _useState10[0],\n      setTime = _useState10[1];\n\n  useEffect(function () {\n    if (time1 === 0) {\n      setTime(1);\n    }\n\n    if (time1 === 1) {\n      setTime(7);\n    }\n\n    if (time1 === 2) {\n      setTime(30);\n    }\n\n    if (time1 === 3) {\n      setTime(30);\n    }\n  }, [time1]);\n\n  var _useQuery = useQuery(tokenDay_QUERY, {\n    variables: {\n      tokenAddress: tokPairsID\n    }\n  }),\n      dayLoading = _useQuery.loading,\n      dayData = _useQuery.data,\n      refetch = _useQuery.refetch;\n\n  useEffect(function () {\n    refetch();\n  }, [tokPairsID]);\n  var tokenName1 = dayData && dayData.pairDayDatas[0].token0.name;\n  var tokenName2 = dayData && dayData.pairDayDatas[0].token1.name;\n  var arr1 = [];\n  var arr2 = [];\n  var arr3 = [];\n  var arr4 = [];\n\n  for (var i = 0; i < time; i++) {\n    var data = dayData && dayData.pairDayDatas[i].reserveUSD;\n\n    var _data = dayData && dayData.pairDayDatas[i].dailyVolumeToken1;\n\n    arr1.push(data);\n    arr4.push(_data);\n  }\n\n  ;\n  var dataL = dayData && dayData.pairDayDatas.length; //Convert epoch date to human readable date - https://stackoverflow.com/questions/34149664/how-to-convert-epoch-to-javascript-date-and-date-to-epoch/34149721\n\n  for (var j = 0; j < time; j++) {\n    var _data2 = dayData && dayData.pairDayDatas[j].date;\n\n    if (_data2 < 10000000000) _data2 *= 1000; // convert to milliseconds (Epoch is usually expressed in seconds, but Javascript uses Milliseconds)\n\n    var _data3 = _data2 + new Date().getTimezoneOffset() * -1; //for timeZone        \n\n\n    var _data4 = new Date(_data3);\n\n    arr2.push(_data4);\n  }\n\n  ;\n\n  for (var k = 0; k < time; k++) {\n    var _data5 = dayData && dayData.pairDayDatas[k].dailyVolumeUSD;\n\n    arr3.push(_data5);\n  }\n\n  ;\n\n  var handleTime2021 = function handleTime2021() {\n    var day = getDayOfYear();\n\n    if (dataL < day) {\n      setTime(dataL);\n      return toast({\n        title: \"Incomplete data\",\n        description: \"Showing the max time this asset has been on Uniswap - consider researching\",\n        status: \"error\",\n        duration: 9000,\n        isClosable: true\n      });\n    } else {\n      setTime(day);\n    }\n  };\n\n  var handleTimeMax = function handleTimeMax() {\n    setTime(dataL);\n  };\n\n  useEffect(function () {\n    var fetchData = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return axios('https://api.coingecko.com/api/v3/coins/ethereum/contract/' + ID1 + '/market_chart/?vs_currency=usd&days=' + time);\n\n              case 3:\n                result = _context.sent;\n                setData1(result.data.prices);\n                _context.next = 10;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                return _context.abrupt(\"return\", toast({\n                  title: \"Error fetching price data for token1\",\n                  status: \"error\",\n                  duration: 9000,\n                  isClosable: true\n                }));\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 7]]);\n      }));\n\n      return function fetchData() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    fetchData();\n  }, [time]);\n  useEffect(function () {\n    var fetchData = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return axios('https://api.coingecko.com/api/v3/coins/ethereum/contract/' + ID2 + '/market_chart/?vs_currency=usd&days=' + time);\n\n              case 3:\n                result = _context2.sent;\n                setData2(result.data.prices);\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n                return _context2.abrupt(\"return\", toast({\n                  title: \"Error fetching price data for token2\",\n                  status: \"error\",\n                  duration: 9000,\n                  isClosable: true\n                }));\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[0, 7]]);\n      }));\n\n      return function fetchData() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    fetchData();\n  }, [time]);\n\n  var _iterator = _createForOfIteratorHelper(totalData1),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var item = _step.value;\n      dataTok1.prices.push(item[1]);\n      if (item[0] < 10000000000) item[0] *= 1000; // convert to milliseconds (Epoch is usually expressed in seconds, but Javascript uses Milliseconds)\n\n      var data1 = item[0] + new Date().getTimezoneOffset() * -1; //for timeZone        \n\n      var data2 = new Date(data1);\n      dataTok1.date.push(data2);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  var _iterator2 = _createForOfIteratorHelper(totalData2),\n      _step2;\n\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var _item = _step2.value;\n      dataTok2.prices.push(_item[1]);\n      if (_item[0] < 10000000000) _item[0] *= 1000; // convert to milliseconds (Epoch is usually expressed in seconds, but Javascript uses Milliseconds)\n\n      var data1 = _item[0] + new Date().getTimezoneOffset() * -1; //for timeZone        \n\n      var data2 = new Date(data1);\n      dataTok2.date.push(data2);\n    } //Correlation Calculation - https://www.investopedia.com/terms/c/correlation.asp\n\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n\n  useEffect(function () {\n    var l = dataTok1.prices.length;\n    var l2 = dataTok2.prices.length;\n\n    if (l2 < l) {\n      l = l2;\n    }\n\n    var a1 = dataTok1.prices;\n    var a2 = dataTok2.prices;\n\n    if (l > 0) {\n      setCorPP((covariance(a1, a2, l) / (std(a1) * std(a2)) * 100).toFixed(2) + \"%\");\n    }\n  }, [totalData1]);\n\n  if (dayLoading) {\n    return /*#__PURE__*/React.createElement(Center, {\n      h: \"100vh\",\n      w: \"100vh\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(Spinner, {\n      thickness: \"4px\",\n      speed: \"0.65s\",\n      emptyColor: \"gray.200\",\n      color: \"pink.500\",\n      size: \"xl\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(HStack, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    pr: \"10px\",\n    size: \"md\",\n    variant: \"solid\",\n    colorScheme: \"pink\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: handleTime2021,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 11\n    }\n  }, \" 2021 \"), /*#__PURE__*/React.createElement(Button, {\n    onClick: handleTimeMax,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 11\n    }\n  }, \" Max \")), /*#__PURE__*/React.createElement(Spacer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Popover, {\n    trigger: \"hover\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(PopoverTrigger, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(Heading, {\n    size: \"md\",\n    ml: \"650px\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 11\n    }\n  }, \"Correlation: \", corPP)), /*#__PURE__*/React.createElement(Portal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(PopoverContent, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(PopoverArrow, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(PopoverHeader, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 7\n    }\n  }, \"Price correlation between \", tokenName1, \" + \", tokenName2), /*#__PURE__*/React.createElement(PopoverCloseButton, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(PopoverBody, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    href: \"/info\",\n    colorScheme: \"blue\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 9\n    }\n  }, \"More info\")))))), /*#__PURE__*/React.createElement(Stack, {\n    spacing: 4,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(Center, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(Heading, {\n    size: \"md\",\n    pt: \"10px\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 6\n    }\n  }, \"Daily volume and total liquidity for \", tokenName1, \"(1) and \", tokenName2, \"(2)\")), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    borderWidth: \"1px\",\n    borderRadius: \"lg\",\n    overflow: \"hidden\",\n    width: \"100%\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Plot, {\n    key: tokPairsID,\n    style: {\n      position: 'relative'\n    },\n    data: [{\n      x: arr2,\n      y: arr1,\n      type: \"line\",\n      name: \"Liquidity\",\n      marker: {\n        color: 'black'\n      }\n    }, {\n      type: 'bar',\n      x: arr2,\n      y: arr3,\n      name: \"Daily Volume USD\",\n      marker: {\n        color: 'pink'\n      }\n    }],\n    layout: {\n      width: 1000,\n      height: 500,\n      legend: {\n        x: 1,\n        xanchor: 'right',\n        y: 1.25,\n        bgcolor: 'white',\n        bordercolor: 'pink',\n        borderwidth: 2\n      },\n      xaxis: {\n        autorange: true,\n        showgrid: false,\n        zeroline: false,\n        showline: false\n      }\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 7\n    }\n  })), /*#__PURE__*/React.createElement(Center, {\n    height: \"10px\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Divider, {\n    orientation: \"horizontal\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 3\n    }\n  })), /*#__PURE__*/React.createElement(Center, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 1\n    }\n  }, /*#__PURE__*/React.createElement(Heading, {\n    size: \"md\",\n    p: \"10px\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 1\n    }\n  }, \"Daily price for \", tokenName1, \"(1) and \", tokenName2, \"(2)\")), /*#__PURE__*/React.createElement(Box, {\n    borderWidth: \"1px\",\n    borderRadius: \"lg\",\n    overflow: \"hidden\",\n    width: \"100%\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Plot, {\n    style: {\n      position: 'relative'\n    },\n    data: [{\n      type: 'line',\n      x: dataTok1.date,\n      y: dataTok1.prices,\n      name: \"Tok1 Price\"\n    }, {\n      type: 'line',\n      x: dataTok2.date,\n      y: dataTok2.prices,\n      name: \"Tok2 Price\",\n      yaxis: 'y2'\n    }],\n    layout: {\n      width: 1000,\n      height: 500,\n      legend: {\n        x: 1,\n        xanchor: 'right',\n        y: 1.25,\n        bgcolor: 'white',\n        bordercolor: 'pink',\n        borderwidth: 2\n      },\n      xaxis: {\n        autorange: true,\n        showgrid: false,\n        zeroline: false,\n        showline: false\n      },\n      yaxis: {\n        title: 'Token1 Price'\n      },\n      yaxis2: {\n        title: 'Token2 Price',\n        titlefont: {\n          color: 'rgb(148, 103, 189)'\n        },\n        tickfont: {\n          color: 'rgb(148, 103, 189)'\n        },\n        overlaying: 'y',\n        side: 'right'\n      }\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 3\n    }\n  })))));\n};\n\n_s(PairsAnalyser, \"yEhXnG/8qRhaDh6HZP15usgCJyQ=\", false, function () {\n  return [useToast, useQuery];\n});\n\n_c = PairsAnalyser;\nexport default PairsAnalyser;\n\nvar _c;\n\n$RefreshReg$(_c, \"PairsAnalyser\");","map":{"version":3,"sources":["/Users/jackevans/Documents/GitHub/ULA-MScCompSci/src/components/PairsAnalyser.jsx"],"names":["React","useState","useEffect","Plot","ApolloClient","HttpLink","InMemoryCache","gql","useQuery","Stack","VStack","Button","ButtonGroup","Box","Heading","useToast","Center","Spinner","Divider","Popover","PopoverTrigger","PopoverContent","PopoverHeader","PopoverBody","PopoverArrow","PopoverCloseButton","Portal","Link","HStack","Spacer","std","axios","client","link","uri","fetchOptions","mode","cache","getDayOfYear","now","Date","start","getFullYear","diff","getTimezoneOffset","oneDay","day","Math","floor","mean","arr","n","sum","i","covariance","arr1","arr2","tokenDay_QUERY","PairsAnalyser","props","tokPairsID","time1","time","ID1","tokID1","ID2","tokID2","total1","total2","totalData1","setData1","totalData2","setData2","loading","setLoading","corPP","setCorPP","dataTok1","date","prices","dataTok2","toast","setTime","variables","tokenAddress","dayLoading","dayData","data","refetch","tokenName1","pairDayDatas","token0","name","tokenName2","token1","arr3","arr4","reserveUSD","data1","dailyVolumeToken1","push","dataL","length","j","data2","k","dailyVolumeUSD","handleTime2021","title","description","status","duration","isClosable","handleTimeMax","fetchData","result","item","l","l2","a1","a2","toFixed","width","height","position","x","y","type","marker","color","legend","xanchor","bgcolor","bordercolor","borderwidth","xaxis","autorange","showgrid","zeroline","showline","yaxis","yaxis2","titlefont","tickfont","overlaying","side"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\n  import Plot from 'react-plotly.js';\n  import { ApolloClient } from 'apollo-client'\n  import { HttpLink } from 'apollo-link-http'\n  import { InMemoryCache } from 'apollo-cache-inmemory'\n  import gql from 'graphql-tag'\n  import { useQuery } from '@apollo/react-hooks'\n  import { \n  Stack, \n  VStack, \n  Button, \n  ButtonGroup, \n  Box, \n  Heading, \n  useToast, \n  Center, \n  Spinner, \n  Divider,\n  Popover,\n  PopoverTrigger,\n  PopoverContent,\n  PopoverHeader,\n  PopoverBody,\n  PopoverArrow,\n  PopoverCloseButton,\n  Portal,\n  Link,\n  HStack,\n  Spacer } from \"@chakra-ui/react\"\n  import {std} from 'mathjs'\n  import axios from 'axios'\n\n  export const client = new ApolloClient({\n    link: new HttpLink({\n      uri: 'https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2'\n    }),\n    fetchOptions: {\n      mode: 'no-cors'\n    },\n    cache: new InMemoryCache()\n  })\n\n  function getDayOfYear(){\n    //https://stackoverflow.com/questions/8619879/javascript-calculate-the-day-of-the-year-1-366\n    var now = new Date();\n    var start = new Date(now.getFullYear(), 0, 0);\n    var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);\n    var oneDay = 1000 * 60 * 60 * 24;\n    var day = Math.floor(diff / oneDay);\n    return day;\n  }\n\n  function mean(arr, n)\n{\n    let sum = 0;\n    for(let i = 0; i < n; i++)\n        sum = sum + arr[i];\n         \n    return sum / n;\n}\n\nfunction covariance(arr1, arr2, n)\n{\n    let sum = 0;\n    for(let i = 0; i < n; i++)\n        sum = sum + (arr1[i] - mean(arr1, n)) *\n                    (arr2[i] - mean(arr2, n));\n                     \n    return sum / (n - 1);\n}\n\n\n  const tokenDay_QUERY = gql`\nquery \n  tokens($tokenAddress: Bytes!){\n pairDayDatas( first: 400, \n orderBy: date, orderDirection: desc,\n   where: {\n     pairAddress: $tokenAddress,\n   }\n ) {\n  token0{\n    name\n  }\n  token1{\n    name\n  }\n     date\n     dailyVolumeToken0\n     dailyVolumeToken1\n     dailyVolumeUSD\n     reserveUSD\n     dailyTxns\n }\n}`\n\n    const PairsAnalyser = (props) => {\n\n      const tokPairsID = props.tokPairsID;\n      const time1 = props.time\n        const ID1 = props.tokID1;\n  const ID2 = props.tokID2;\n         var total1 = 0;\n  var total2 = 0;\n\n\n\n\n    const [totalData1, setData1] = useState([]);\n    const [totalData2, setData2] = useState([]);\n    const [loading, setLoading] = useState(false);\n     const [corPP, setCorPP] = useState(0)\n  let dataTok1 = { date: [], prices: []};\n  let dataTok2 = { date: [], prices: []};\n\n  const toast = useToast();\n\n\n\n      const [time, setTime] = useState(7)\n      \n      useEffect(() => { \n        if(time1===0){\n        setTime(1)\n      }\n        if(time1===1){\n        setTime(7)\n      }\n       if(time1===2){\n        setTime(30)\n      }\n       if(time1===3){\n        setTime(30)\n      } }, [time1])\n     \n\n\n      const { loading: dayLoading, data: dayData, refetch } = useQuery(tokenDay_QUERY,\n        { variables: {tokenAddress: tokPairsID}});\n      useEffect(() => { refetch() }, [tokPairsID])\n\n   \n      \n\n      const tokenName1 = dayData && dayData.pairDayDatas[0].token0.name\n      const tokenName2 = dayData && dayData.pairDayDatas[0].token1.name\n      \n   \n    var arr1 = [];\n    var arr2 = [];\n    var arr3 = [];\n    var arr4 = []\n\n    for (var i = 0; i < time; i++) {\n      \n      const data = dayData && dayData.pairDayDatas[i].reserveUSD\n      const data1 = dayData && dayData.pairDayDatas[i].dailyVolumeToken1\n\n     arr1.push(data)\n     arr4.push(data1)\n    };\n    const dataL = dayData && dayData.pairDayDatas.length;\n\n    //Convert epoch date to human readable date - https://stackoverflow.com/questions/34149664/how-to-convert-epoch-to-javascript-date-and-date-to-epoch/34149721\n    for (var j = 0; j < time; j++) {\n      let data = dayData && dayData.pairDayDatas[j].date\n      if (data < 10000000000)\n          data *= 1000; // convert to milliseconds (Epoch is usually expressed in seconds, but Javascript uses Milliseconds)\n      let data1 = data + (new Date().getTimezoneOffset() * -1); //for timeZone        \n      let data2 = new Date(data1);\n\n      arr2.push(data2)\n    };\n    for (var k = 0; k < time; k++) {\n      const data = dayData && dayData.pairDayDatas[k].dailyVolumeUSD\n      arr3.push(data)\n    };\n\n    const handleTime2021 = () => {\n        var day = getDayOfYear();\n      if(dataL<day){\n      setTime(dataL)\n      return (\n        toast({\n          title: \"Incomplete data\",\n          description: \"Showing the max time this asset has been on Uniswap - consider researching\",\n          status: \"error\",\n          duration: 9000,\n          isClosable: true,\n        }));}\n    else{\n      setTime(day)\n    }\n\n    }\n    const handleTimeMax = () => {\n      setTime(dataL)\n    }\n\n\n  useEffect(() => { \n    const fetchData = async () => {\n      try{\n    const result = await axios('https://api.coingecko.com/api/v3/coins/ethereum/contract/'+ID1+'/market_chart/?vs_currency=usd&days='+time)\n    setData1(result.data.prices)\n  }\n  catch (error) {\n       return(toast({\n          title: \"Error fetching price data for token1\",\n          status: \"error\",\n          duration: 9000,\n          isClosable: true,\n        })\n       )\n    }\n}\n  ;\n  fetchData();\n}, [time]);\n\n  useEffect(() => { \n    const fetchData = async () => {\n      try{\n    const result = await axios('https://api.coingecko.com/api/v3/coins/ethereum/contract/'+ID2+'/market_chart/?vs_currency=usd&days='+time)\n    setData2(result.data.prices)\n  }\n   catch (error) {\n       return(toast({\n          title: \"Error fetching price data for token2\",\n          status: \"error\",\n          duration: 9000,\n          isClosable: true,\n        })\n       )\n    }\n}\n  fetchData()\n}, [time]);\n\n    for (const item of totalData1) {\n      dataTok1.prices.push(item[1]);\n      if (item[0] < 10000000000)\n          item[0] *= 1000; // convert to milliseconds (Epoch is usually expressed in seconds, but Javascript uses Milliseconds)\n      var data1 = item[0] + (new Date().getTimezoneOffset() * -1); //for timeZone        \n      var data2 = new Date(data1);\n      dataTok1.date.push(data2);\n        \n    }\n\n      for (const item of totalData2) {\n      dataTok2.prices.push(item[1]);\n      if (item[0] < 10000000000)\n          item[0] *= 1000; // convert to milliseconds (Epoch is usually expressed in seconds, but Javascript uses Milliseconds)\n      var data1 = item[0] + (new Date().getTimezoneOffset() * -1); //for timeZone        \n      var data2 = new Date(data1);\n      dataTok2.date.push(data2);}\n        \n\n\n//Correlation Calculation - https://www.investopedia.com/terms/c/correlation.asp\n  useEffect(() => { \n    var l = dataTok1.prices.length\n    var l2 = dataTok2.prices.length\n    if(l2<l){\n      l=l2\n    }\n    var a1 = dataTok1.prices;\n    var a2 = dataTok2.prices;\n \n    if(l>0){ \n    \n   setCorPP((((covariance(a1,a2,l)/(std(a1)*std(a2)))*100).toFixed(2))+\"%\")\n}\n}\n,[totalData1])\n    \n\n    if(dayLoading){\n    return(\n\n  \n    <Center h=\"100vh\" w=\"100vh\">\n    <Spinner\n    thickness=\"4px\"\n    speed=\"0.65s\"\n    emptyColor=\"gray.200\"\n    color=\"pink.500\"\n    size=\"xl\"\n    />\n    </Center>\n\n\n    )\n  }\n\n    return (\n     <div>\n     <HStack>\n     <ButtonGroup pr = \"10px\" size = \"md\" variant=\"solid\" colorScheme=\"pink\" >\n          <Button onClick = {handleTime2021} > 2021 </Button>\n          <Button onClick = {handleTimeMax} > Max </Button>\n     </ButtonGroup>\n      <Spacer />\n     <Popover trigger=\"hover\">\n  <PopoverTrigger >\n          <Heading size=\"md\" ml=\"650px\"\n                  >Correlation: {corPP}</Heading>\n  </PopoverTrigger>\n  <Portal>\n    <PopoverContent>\n      <PopoverArrow />\n      <PopoverHeader>Price correlation between {tokenName1} + {tokenName2}</PopoverHeader>\n      <PopoverCloseButton />\n      <PopoverBody>\n        <Link href=\"/info\" colorScheme=\"blue\">More info</Link>\n      </PopoverBody>\n    </PopoverContent>\n  </Portal>\n</Popover>\n\n    </HStack>\n     <Stack spacing={4}>\n     <Center>\n     <Heading size=\"md\"pt=\"10px\">\n      Daily volume and total liquidity for {tokenName1}(1) and {tokenName2}(2) \n     </Heading>\n     </Center>\n        <div style={{ width: \"100%\", height: \"100%\" }}>\n      <Box borderWidth=\"1px\" borderRadius=\"lg\" overflow=\"hidden\" width=\"100%\" >\n      <Plot \n      key = {tokPairsID}\n      style={{\n        position: 'relative'\n      }}\n      data={[\n        {\n          x: arr2,\n          y: arr1,\n          type: \"line\",\n          name: \"Liquidity\",\n          marker: {\n             color: 'black'\n          }\n        },\n        \n        {\n          type: 'bar',\n          x: arr2, \n          y: arr3,\n          name: \"Daily Volume USD\",\n          marker: {\n                  color: 'pink'\n                }\n              }\n\n              ]}\n              layout={{ width: 1000, height: 500,\n                legend: {\n    x: 1,\n    xanchor: 'right',\n    y: 1.25,\n    bgcolor: 'white',\n    bordercolor: 'pink',\n    borderwidth: 2\n  },\n                xaxis: {\n                  autorange: true,\n                  showgrid: false,\n            zeroline: false,\n            showline: false,\n                \n        }}}\n          />\n          </Box>\n          <Center height=\"10px\">\n  <Divider orientation=\"horizontal\" />\n</Center>\n<Center>\n<Heading size=\"md\" p=\"10px\">\n      Daily price for {tokenName1}(1) and {tokenName2}(2) \n     </Heading>\n</Center>\n          <Box borderWidth=\"1px\" borderRadius=\"lg\" overflow=\"hidden\" width=\"100%\" >\n  <Plot \n      style={{\n        position: 'relative'\n      }}\n      data={[\n        {\n          type: 'line',\n          x: dataTok1.date, \n          y: dataTok1.prices,\n          name: \"Tok1 Price\"\n        },\n        {\n          type: 'line',\n          x: dataTok2.date, \n          y: dataTok2.prices,\n          name: \"Tok2 Price\",\n          yaxis: 'y2'\n        }\n\n        ]}\n        layout={{ width: 1000, height: 500,\n          legend: {\n    x: 1,\n    xanchor: 'right',\n    y: 1.25,\n    bgcolor: 'white',\n    bordercolor: 'pink',\n    borderwidth: 2\n  },\n          xaxis: {\n            autorange: true,\n            showgrid: false,\n            zeroline: false,\n            showline: false,\n          },\n          yaxis: { title: 'Token1 Price'},\n          yaxis2: {\n    title: 'Token2 Price',\n    titlefont: {color: 'rgb(148, 103, 189)'},\n    tickfont: {color: 'rgb(148, 103, 189)'},\n    overlaying: 'y',\n    side: 'right'\n  }\n\n          }}\n          />\n          </Box>       \n          </div>\n          </Stack>\n          </div>\n          \n\n          );\n\n\n  };\n  export default PairsAnalyser;"]},"metadata":{},"sourceType":"module"}